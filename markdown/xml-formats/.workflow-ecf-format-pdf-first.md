# WORKFLOW: ecf-format-v1.0 PDF-First 3-Version Approach

## üéØ Objective

Create a **TRUE 1:1 Spanish representation** from the PDF using extracted data, NOT using the optimized markdown as a reference.

## üìã Key Principles

1. **PDF is Source of Truth** - Extract content directly from PDF and camelot/pdfplumber dumps
2. **Do NOT reference** `ecf-format-v1.0.md` (optimized version) - ignore it completely
3. **Use PDF Extractions** - camelot and pdfplumber data in `/exports/` directory
4. **Preserve PDF Structure** - Keep exact same structure, wording, and organization as PDF
5. **Spanish First** - Create `-original.md` (Spanish) as 1:1 PDF representation
6. **Then English** - Create `-complete.md` as 1:1 translation of Spanish original

## üóÇÔ∏è Available Resources

### PDF Location
- **PDF**: `Formato Comprobante Fiscal Electr√≥nico (e-CF) V1.0.pdf`
- **Export Directory**: `/home/romulo/visual/ecf/ecf-docs/exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/`

### Extraction Data Available
```
exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/
‚îú‚îÄ‚îÄ camelot/
‚îÇ   ‚îú‚îÄ‚îÄ lattice/         # 191 tables extracted
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page-*.csv   # CSV format of tables
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page-*.json  # JSON format of tables
‚îÇ   ‚îî‚îÄ‚îÄ stream/          # Alternative extraction method
‚îú‚îÄ‚îÄ pdfplumber/
‚îÇ   ‚îî‚îÄ‚îÄ tables/          # Additional table extractions
‚îî‚îÄ‚îÄ source.pdf           # Symlink to original PDF
```

### Key Files to Use
- **Table Data**: `camelot/lattice/*.csv` and `camelot/lattice/*.json`
- **Alternative**: `pdfplumber/tables/*.csv`
- **Verification**: Compare both camelot and pdfplumber for accuracy

## üìù Workflow Steps

### Phase 1: Spanish Original (`ecf-format-v1.0-original.md`)

#### Step 1: Extract PDF Text Structure
1. Read the PDF directly or use text extraction
2. Note the exact section organization from PDF
3. Identify all headers, subheaders, page numbers
4. Extract footnotes and their exact placement

#### Step 2: Extract Tables from PDF Data
1. Use `camelot/lattice/*.csv` for table data
2. Cross-reference with `pdfplumber/tables/` for verification
3. For each table:
   - Preserve exact column headers from PDF
   - Preserve exact row data
   - Preserve exact Spanish field names
   - Keep all footnote references
   - Maintain exact spacing/structure

#### Step 3: Build Section by Section
Work page-by-page through the PDF:

**Priority Order:**
1. **Cover & Version History** (Pages 1-5)
   - Exact title from PDF
   - Version table with all entries
   - Introduction text verbatim

2. **Section A: Encabezado** (Pages ~10-35)
   - Extract field tables from camelot data
   - Preserve exact Spanish descriptions
   - Keep all validation notes from PDF
   - Include all footnotes with original numbering

3. **Section B: DetallesItem** (Pages ~36-50)
   - Item-level field tables
   - All subsections as in PDF

4. **Sections C-H** (Pages ~51-62)
   - Supporting sections
   - Exact structure from PDF

5. **Tables (TABLAS)** (Pages ~63-86)
   - All reference tables
   - Exact codes and descriptions from PDF

6. **Validation Rules** (Final pages)
   - Business rules
   - Footnotes summary

#### Step 4: Verify PDF Fidelity
- Compare line-by-line with PDF
- Check all table field counts match
- Verify all Spanish terminology is exact
- Ensure all footnotes are included

### Phase 2: English Complete (`ecf-format-v1.0-complete.md`)

1. Translate Spanish original line-by-line
2. Preserve all Spanish technical terms (RNC, e-NCF, ITBIS, ISC, XML tags)
3. Translate descriptions, validation notes, business rules
4. Keep exact same structure as Spanish

### Phase 3: Cross-Check (Optional)

1. Compare optimized version with original/complete
2. Document any differences
3. Ask user before making ANY changes to optimized version

## ‚ö†Ô∏è Critical DO NOTs

1. ‚ùå **DO NOT** open or reference `ecf-format-v1.0.md` (optimized)
2. ‚ùå **DO NOT** use optimized version as template
3. ‚ùå **DO NOT** copy any content from optimized version
4. ‚ùå **DO NOT** modify optimized version without explicit user approval

## ‚úÖ Critical DOs

1. ‚úÖ **DO** use PDF as only source of truth
2. ‚úÖ **DO** use camelot/pdfplumber CSV/JSON data
3. ‚úÖ **DO** preserve exact PDF structure and wording
4. ‚úÖ **DO** include ALL footnotes from PDF
5. ‚úÖ **DO** verify field counts match PDF tables

## üîç How to Verify You're Doing It Right

**Good Signs:**
- You're reading CSV files from camelot directory
- You're checking page numbers in PDF
- You're preserving Spanish text exactly as in PDF
- Your field descriptions match PDF verbatim
- You're including footnotes with original numbers

**Bad Signs:**
- You're looking at ecf-format-v1.0.md
- Your descriptions are "cleaner" than PDF
- You're "improving" the structure
- You're omitting footnotes or PDF quirks
- Tables have different field counts than PDF

## üìä Expected Differences from Optimized

The **original** should:
- Have MORE verbose descriptions (PDF is wordier)
- Include ALL footnotes inline
- Have exact Spanish wording from PDF (not cleaned up)
- Preserve PDF's organizational quirks
- Be ~10-20% longer than optimized version

## üöÄ Quick Start Commands

```bash
# View available PDF extractions
ls -lh exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/camelot/lattice/

# Check a table extraction
head -20 exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/camelot/lattice/page-10.csv

# Compare camelot vs pdfplumber for a page
diff exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/camelot/lattice/page-10.csv \
     exports/Formato-Comprobante-Fiscal-Electronico-e-CF-V1.0_c811c9/pdfplumber/tables/page-10-table-0.csv

# Start fresh - remove old attempts
rm markdown/xml-formats/ecf-format-v1.0-original.md
rm markdown/xml-formats/ecf-format-v1.0-complete.md
```

## üìù Section-by-Section Extraction Plan

### Cover & Intro (Pages 1-9)
- **Extract**: Title, version, date, full version history table
- **Source**: Direct PDF text + camelot page-4.csv for version table
- **Fields**: All version entries with exact Spanish dates/descriptions

### A.1 IdDoc (Page ~10-12)
- **Extract**: Field table #1-19
- **Source**: camelot/lattice/page-10.csv through page-12.csv
- **Verify**: 19 fields total, exact Spanish descriptions

### A.2 Emisor (Page ~13-15)
- **Extract**: Field table #20-37
- **Source**: camelot/lattice/page-13.csv through page-15.csv
- **Verify**: 18 fields total

### A.3 Comprador (Page ~16-18)
- **Extract**: Field table #38-55
- **Source**: camelot/lattice/page-16.csv through page-18.csv
- **Verify**: 18 fields total

### Continue pattern for all sections...

---

## üéØ Success Metrics

**Spanish Original Success:**
- ‚úÖ All field counts match PDF exactly
- ‚úÖ All Spanish descriptions verbatim from PDF
- ‚úÖ All footnotes included with original numbering
- ‚úÖ Structure matches PDF page organization
- ‚úÖ Tables have exact columns as PDF
- ‚úÖ NO content borrowed from optimized version

**English Complete Success:**
- ‚úÖ Perfect 1:1 translation of Spanish original
- ‚úÖ All Spanish technical terms preserved
- ‚úÖ Same structure as Spanish
- ‚úÖ All footnotes translated

---

**Remember: The goal is TRUE PDF fidelity, not clean/optimized documentation!**
