"try {"
"// Creamos un DOM XMLSignatureFactory. Se usar√° para generar la firma"
"XMLSignatureFactory fac = XMLSignatureFactory.getInstance(""DOM"");"
"Reference ref = fac.newReference("""", fac.newDigestMethod(DigestMethod.SHA256, null),"
"Collections.singletonList(fac.newTransform(Transform.ENVELOPED,"
"(TransformParameterSpec) null)),"
"null,"
"null);"
"// Creamos el objeto SignedInfo"
"SignedInfo si ="
"fac.newSignedInfo(fac.newCanonicalizationMethod(CanonicalizationMethod.INCLUSIVE,"
"(C14NMethodParameterSpec) null),"
"fac.newSignatureMethod(algoritmoSignatureMethod, null),"
"Collections.singletonList(ref));"
"// Cargamos el archivo p12 desde disco"
"KeyStore ks = KeyStore.getInstance(""PKCS12"");"
"ks.load(streamCerticate, passwordCertificate.toCharArray());"
"String param = ks.aliases().nextElement();"
"// Extraemos los datos del archivo p12"
"KeyStore.PrivateKeyEntry keyEntry = (KeyStore.PrivateKeyEntry) ks"
".getEntry(param, new"
"KeyStore.PasswordProtection(passwordCertificate.toCharArray()));"
"X509Certificate cert = (X509Certificate) keyEntry.getCertificate();"
"KeyInfoFactory kinfoFactory = fac.getKeyInfoFactory();"
"// Cargamos nuestro certificado"
"List<Serializable> x509Content = new ArrayList<Serializable>();"
"x509Content.add(cert);"
"// Objetos para extraer la llave privada"
"X509Data x509d = kinfoFactory.newX509Data(x509Content);"
"KeyInfo kinfo = kinfoFactory.newKeyInfo(Collections.singletonList(x509d));"
"DOMParser parser = new DOMParser();"
"parser.setPreserveWhitespace(false);"
"parser.parse(streamXML);"
"XMLDocument xml =parser.getDocument();"
"Element xmlRoot = xml.getDocumentElement();"
"// Crea el contexto de firmma y especifica las llaves privadas"
"DOMSignContext dsc = new DOMSignContext(keyEntry.getPrivateKey(), xmlRoot);"
