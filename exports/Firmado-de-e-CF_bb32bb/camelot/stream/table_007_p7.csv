"constructor() { }"
"/* El parametro xml:un string formateado en xml:"
"(""<ECF><eNCF>E310000000001</eNCF></ECF>"")."
"El parametro certificado:  tipo ArrayBuffer, puede provenir de un control fileUpload."
"El Password:es el valor de la clave del certificado."
"*/"
"//MÃ©todo utilizado para generar la firma del xml."
"public Firmar(xml:any,certifado: ArrayBuffer,password:string) {"
"//Se Genera el  PEM & PrivateKey del certificado"
"let pem = this.convertToPem(certifado, password);"
"let privateKey = forge.pki.privateKeyFromPem(pem.pemKey);"
"//-----------------------------------------------------------"
"//Se prepara la  encriptacion del contenido del xml"
"let md = forge.md.sha256.create();"
"var xmlData2 = (new xmldom.DOMParser()).parseFromString(xml);"
"//Canolizacion del tag SignedInfo para poder generar correctamente la firma del documento."
"var xmlCanolizadoData2=this.c14nCanonicalization(xmlData2.firstChild,null);"
"md.update(xmlCanolizadoData2.toString(), 'utf8');"
"//------------------------------------------------------------"
"/* Se obtiene solo el contenido del en formato encode64"
"para luego asignar este valor a el tag DigestValue"
"*/"
"let messageDigest = forge.util.encode64(md.digest().data);"
"//------------------------------------------------------------"
"//Se construye el xml con el tag de firma integrado en este punto aun no se genera el tag"
"SignatureValue"
"let pemXMLFormat=this.obtenerPEMXMLFormat(pem.pemCertificate);"
"let xmlSinFirmado="
"this.agregarEstructuraFirma(xmlCanolizadoData2.toString(),pemXMLFormat,messageDigest);"
"/*Se convierte a formato XML la transformacion anterior. Esta transformacion es necesaria"
"para poder obtener la  canolizacion del XML."
"*/"
"var xmlData = (new xmldom.DOMParser()).parseFromString(xmlSinFirmado);"
"//Canolizacion del tag SignedInfo para poder generar correctamente la firma del documento."
"var"
"xmlCanolizado=this.c14nCanonicalization(xmlData.getElementsByTagName(""SignedInfo"")[0],{defau"
"ltNsForPrefix:{ds: 'http://www.w3.org/2000/09/xmldsig#'}});"
